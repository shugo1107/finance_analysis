<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chart</title>
    <style>
        #dashboard_div{
            width: 1000px;
            border: 1px solid #ccc;
        }
        #chart_div{
            height:600px;
            border-bottom: 1px solid #ccc;
        }
        #filter_div{
            height:50px;
        }
        .technical_title{
            margin: 10px;
            color: gray;
        }
        .bottom_chart{
            border-bottom: 1px solid #ccc;
        }
    </style>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {'packages':['corechart', 'controls']});

        var config = {
            api:{
                enable: true,
                interval: 1000 * 3
            },
            candlestick:{
                product_code: 'USD_JPY',
                duration: '1m',
                limit: 365,
                numViews: 5,
            },
            dataTable: {
                index : 0,
                value: null
            },
            sma: {
                enable: false,
                indexes: [],
                periods: [],
                values: []
            },
            ema: {
                enable: false,
                indexes: [],
                periods: [],
                values: []
            },
            bbands: {
                enable: false,
                indexes: [],
                n: 20,
                k: 2,
                up: [],
                mid: [],
                down: []
            },
            atr: {
                enable: false,
                indexes: [],
                n: 20,
                k: 2,
                up: [],
                down: []
            },
            ichimoku: {
                enable: false,
                indexes: [],
                tenkan: [],
                kijun: [],
                senkouA : [],
                senkouB: [],
                chikou: []
            },
            events: {
                enable: false,
                indexes: [],
                values: [],
                first: null
            },
            volume: {
                enable: false,
                index: [],
                values: []
            },
            di: {
                enable: false,
                indexes: [],
                n: 14,
                plus_di: [],
                minus_di: []
            },
            adx: {
                enable: false,
                indexes: [],
                n: 14,
                adx: [],
                adxr: []
            },
            rsi: {
                enable: false,
                indexes: {'up': 0, 'value': 0, 'down': 0},
                period: 14,
                up: 70,
                values: [],
                down: 30
            },
            macd: {
                enable: false,
                indexes: [],
                periods: [],
                values: []
            },
            force_idx: {
                enable: false,
                indexes: [],
                periods: [],
                values: []
            },
        };

        function initConfigValues(){
            config.dataTable.index = 0;
            config.sma.indexes = [];
            config.sma.values = [];
            config.ema.indexes = [];
            config.ema.values = [];
            config.bbands.indexes = [];
            config.bbands.up = [];
            config.bbands.mid = [];
            config.bbands.down = [];
            config.atr.indexes = [];
            config.atr.up = [];
            config.atr.down = [];
            config.ichimoku.indexes = [];
            config.ichimoku.tenkan = [];
            config.ichimoku.kijun = [];
            config.ichimoku.senkouA= [];
            config.ichimoku.senkouB= [];
            config.ichimoku.chikou = [];
            config.events.indexes = [];
            config.events.values = [];
            config.volume.index = [];
            config.di.indexes = [];
            config.di.plus_di = [];
            config.di.minus_di = [];
            config.adx.indexes = [];
            config.adx.adx = [];
            config.adx.adxr = [];
            config.rsi.indexes = [];
            config.macd.indexes = [];
            config.macd.periods = [];
            config.macd.values = [];
            config.force_idx.indexes = [];
            config.force_idx.values = [];
        }

        function drawChart(dataTable) {
            var chartDiv = document.getElementById('chart_div');
            var charts = [];
            var dashboard = new google.visualization.Dashboard(chartDiv);
            var mainChart = new google.visualization.ChartWrapper({
                chartType: 'ComboChart',
                containerId: 'chart_div',
                options: {
                    hAxis: {'slantedText': false},
                    legend: {'position': 'none'},
                    candlestick: {
                        fallingColor: { strokeWidth: 0, fill: '#a52714' },
                        risingColor: { strokeWidth: 0, fill: '#0f9d58' }
                    },
                    seriesType: "candlesticks",
                    series: {}
                },
                view: {
                    columns: [
                        {
                            calc: function(d, rowIndex) {
                                return d.getFormattedValue(rowIndex, 0);
                            },
                            type: 'string'

                        }, 1, 2, 3, 4
                    ]

                }

            });
            charts.push(mainChart);

            var options = mainChart.getOptions();
            var view = mainChart.getView();

            if (config.sma.enable == true) {
                for (i = 0; i < config.sma.indexes.length; i++) {
                    options.series[config.sma.indexes[i]] = {type: 'line'};
                    view.columns.push(config.candlestick.numViews + config.sma.indexes[i]);
                }
            }

            if (config.ema.enable == true) {
                for (i = 0; i < config.ema.indexes.length; i++) {
                    options.series[config.ema.indexes[i]] = {type: 'line'};
                    view.columns.push(config.candlestick.numViews + config.ema.indexes[i]);
                }
            }

            if (config.bbands.enable == true) {
                for (i = 0; i < config.bbands.indexes.length; i++) {
                    options.series[config.bbands.indexes[i]] = {
                        type: 'line',
                        color: 'blue',
                        lineWidth: 1
                    };
                    view.columns.push(config.candlestick.numViews + config.bbands.indexes[i])
                }
            }

            if (config.atr.enable == true) {
                for (i = 0; i < config.atr.indexes.length; i++) {
                    options.series[config.atr.indexes[i]] = {
                        type: 'line',
                        color: 'green',
                        lineWidth: 1
                    };
                    view.columns.push(config.candlestick.numViews + config.atr.indexes[i])
                }
            }

            if (config.ichimoku.enable == true) {
                for (i = 0; i < config.ichimoku.indexes.length; i++) {
                    options.series[config.ichimoku.indexes[i]] = {
                        type: 'line',
                        lineWidth: 1
                    };
                    view.columns.push(config.candlestick.numViews + config.ichimoku.indexes[i]);
                }
            }

            if (config.events.enable == true && config.events.indexes.length > 0){
                options.series[config.events.indexes[0]] = {
                    'type': 'line',
                    tooltip: 'none',
                    enableInteractivity: false,
                    lineWidth: 0
                };
                view.columns.push(config.candlestick.numViews + config.events.indexes[0]);
                view.columns.push(config.candlestick.numViews + config.events.indexes[1]);
            }

            if (config.volume.enable == true) {
                if ($('#volume_div').length == 0) {
                    $('#technical_div').append(
                            "<div id='volume_div' class='bottom_chart'>" +
                            "<span class='technical_title'>Volume</span>" +
                            "<div id='volume_chart'></div>" +
                            "</div>")
                }
                var volumeChart = new google.visualization.ChartWrapper({
                    'chartType': 'ColumnChart',
                    'containerId': 'volume_chart',
                    'options': {
                        'hAxis': {'slantedText': false},
                        'legend': {'position': 'none'},
                        'series': {}
                    },
                    'view': {
                        'columns': [ { 'type': 'string' }, 5]
                    }
                });
                charts.push(volumeChart)
            }

            if (config.di.enable == true) {
                if ($('#di_div').length == 0) {
                    $('#technical_div').append(
                            "<div id='di_div' class='bottom_chart'>" +
                            "<span class='technical_title'>DI</span>" +
                            "<div id='di_chart'></div>" +
                            "</div>")
                }
                var diColumns = [{'type': 'string'}];

                diColumns.push(config.candlestick.numViews + config.di.indexes[0]);
                diColumns.push(config.candlestick.numViews + config.di.indexes[1]);
                var diChart = new google.visualization.ChartWrapper({
                    'chartType': 'LineChart',
                    'containerId': 'di_chart',
                    'options': {
                        'hAxis': {'slantedText': false},
                        'legend': {'position': 'none'},
                        'series': {
                            0: {type: 'line', lineWidth: 1},
                            1: {type: 'line', lineWidth: 1}
                        }
                    },
                    'view': {
                        'columns': diColumns
                    }
                });
                charts.push(diChart)
            }

            if (config.adx.enable == true) {
                if ($('#adx_div').length == 0) {
                    $('#technical_div').append(
                            "<div id='adx_div' class='bottom_chart'>" +
                            "<span class='technical_title'>ADX</span>" +
                            "<div id='adx_chart'></div>" +
                            "</div>")
                }
                var adxColumns = [{'type': 'string'}];

                adxColumns.push(config.candlestick.numViews + config.adx.indexes[0]);
                adxColumns.push(config.candlestick.numViews + config.adx.indexes[1]);
                var adxChart = new google.visualization.ChartWrapper({
                    'chartType': 'LineChart',
                    'containerId': 'adx_chart',
                    'options': {
                        'hAxis': {'slantedText': false},
                        'legend': {'position': 'none'},
                        'series': {
                            0: {type: 'line', lineWidth: 1},
                            1: {type: 'line', lineWidth: 1}
                        }
                    },
                    'view': {
                        'columns': adxColumns
                    }
                });
                charts.push(adxChart)
            }

            if (config.rsi.enable == true) {
                if ($('#rsi_div').length == 0) {
                    $('#technical_div').append(
                            "<div id='rsi_div' class='bottom_chart'>" +
                            "<span class='technical_title'>RSI</span>" +
                            "<div id='rsi_chart'></div>" +
                            "</div>")
                }
                var up = config.candlestick.numViews + config.rsi.indexes['up'];
                var value = config.candlestick.numViews + config.rsi.indexes['value'];
                var down = config.candlestick.numViews + config.rsi.indexes['down'];
                var rsiChart = new google.visualization.ChartWrapper({
                    'chartType': 'LineChart',
                    'containerId': 'rsi_chart',
                    'options': {
                        'hAxis': {'slantedText': false},
                        'legend': {'position': 'none'},
                        'series': {
                            0: {color: 'black', lineWidth: 1},
                            1: {color: '#e2431e'},
                            2: {color: 'black', lineWidth: 1}
                        }
                    },
                    'view': {
                        'columns': [ { 'type': 'string' }, up, value, down]
                    }
                });
                charts.push(rsiChart)
            }

            if (config.force_idx.enable == true) {
                if (config.force_idx.indexes.length == 0) { return }
                if ($('#force_idx_div').length == 0) {
                    $('#technical_div').append(
                            "<div id='force_idx_div'>" +
                            "<span class='technical_title'>Force_Index</span>" +
                            "<div id='force_idx_chart'></div>" +
                            "</div>")
                }
                var forceIdxColumns = [{'type': 'string'}];

                forceIdxColumns.push(config.candlestick.numViews + config.force_idx.indexes[0]);
                forceIdxColumns.push(config.candlestick.numViews + config.force_idx.indexes[1]);
                forceIdxColumns.push(config.candlestick.numViews + config.force_idx.indexes[2]);
                var forceIdxChart = new google.visualization.ChartWrapper({
                    'chartType': 'ComboChart',
                    'containerId': 'force_idx_chart',
                    'options': {
                        legend: {'position': 'none'},
                        seriesType: "bars",
                        series: {
                            1: {type: 'line', lineWidth: 1},
                            2: {type: 'line', lineWidth: 1}
                        }
                    },
                    'view': {
                        'columns': forceIdxColumns
                    }
                });
                charts.push(forceIdxChart)
            }

            if (config.macd.enable == true) {
                if (config.macd.indexes.length == 0) { return }
                if ($('#macd_div').length == 0) {
                    $('#technical_div').append(
                            "<div id='macd_div'>" +
                            "<span class='technical_title'>MACD</span>" +
                            "<div id='macd_chart'></div>" +
                            "</div>")
                }
                var macdColumns = [{'type': 'string'}];

                macdColumns.push(config.candlestick.numViews + config.macd.indexes[2]);
                macdColumns.push(config.candlestick.numViews + config.macd.indexes[0]);
                macdColumns.push(config.candlestick.numViews + config.macd.indexes[1]);
                var macdChart = new google.visualization.ChartWrapper({
                    'chartType': 'ComboChart',
                    'containerId': 'macd_chart',
                    'options': {
                        legend: {'position': 'none'},
                        seriesType: "bars",
                        series: {
                            1: {type: 'line', lineWidth: 1},
                            2: {type: 'line', lineWidth: 1}
                        }
                    },
                    'view': {
                        'columns': macdColumns
                    }
                });
                charts.push(macdChart)
            }

            var controlWrapper = new google.visualization.ControlWrapper({
                'controlType': 'ChartRangeFilter',
                'containerId': 'filter_div',
                'options': {
                    'filterColumnIndex': 0,
                    'ui': {
                        'chartType': 'LineChart',
                        'chartView': {
                            'columns': [0, 4]
                        }
                    }
                }
            });

            dashboard.bind(controlWrapper, charts);
            dashboard.draw(dataTable);

        }

        function send () {
            if (config.api.enable == false){
                return
            }
            var params = {
                "product_code": config.candlestick.product_code,
                "limit": config.candlestick.limit,
                "duration": config.candlestick.duration,
            };

            if (config.sma.enable == true) {
                params["sma"] = true;
                params["smaPeriod1"] = config.sma.periods[0];
                params["smaPeriod2"] = config.sma.periods[1];
                params["smaPeriod3"] = config.sma.periods[2];
            }

            if (config.ema.enable == true) {
                params["ema"] = true;
                params["emaPeriod1"] = config.ema.periods[0];
                params["emaPeriod2"] = config.ema.periods[1];
                params["emaPeriod3"] = config.ema.periods[2];
            }

            if (config.bbands.enable == true) {
                params["bbands"] = true;
                params["bbandsN"] = config.bbands.n;
                params["bbandsK"] = config.bbands.k;
            }

            if (config.atr.enable == true) {
                params["atr"] = true;
                params["atrN"] = config.atr.n;
                params["atrK"] = config.atr.k;
            }

            if (config.ichimoku.enable == true) {
                params["ichimoku"] = true;
            }

            if (config.events.enable == true) {
                params["events"] = true;
            }

            if (config.di.enable == true) {
                params["di"] = true;
                params["diN"] = config.di.n;
            }

            if (config.adx.enable == true) {
                params["adx"] = true;
                params["adxN"] = config.adx.n;
            }

            if (config.rsi.enable == true) {
                params["rsi"] = true;
                params["rsiPeriod"] = config.rsi.period;
            }

            if (config.macd.enable == true) {
                params["macd"] = true;
                params["macdPeriod1"] = config.macd.periods[0];
                params["macdPeriod2"] = config.macd.periods[1];
                params["macdPeriod3"] = config.macd.periods[2];
            }

            if (config.force_idx.enable == true) {
                params["force_idx"] = true;
                params["forceIdxPeriod1"] = config.force_idx.periods[0];
                params["forceIdxPeriod2"] = config.force_idx.periods[1];
                params["forceIdxPeriod3"] = config.force_idx.periods[2];
            }

            $.get("/api/candle/", params).done(function (data) {
                initConfigValues();
                var dataTable = new google.visualization.DataTable();
                dataTable.addColumn('date', 'Date');
                dataTable.addColumn('number', 'Low');
                dataTable.addColumn('number', 'Open');
                dataTable.addColumn('number', 'Close');
                dataTable.addColumn('number', 'High');
                dataTable.addColumn('number', 'Volume');

                if (data["smas"] != undefined) {
                    for (i = 0; i < data['smas'].length; i++){
                        var smaData = data['smas'][i];
                        if (smaData.length == 0){ continue; }
                        config.dataTable.index += 1;
                        config.sma.indexes[i] = config.dataTable.index;
                        dataTable.addColumn('number', 'SMA' + smaData["period"].toString());
                        config.sma.values[i] = smaData["values"]
                    }
                }

                if (data["emas"] != undefined) {
                    for (i = 0; i < data['emas'].length; i++){
                        var emaData = data['emas'][i];
                        if (emaData.length == 0){ continue; }
                        config.dataTable.index += 1;
                        config.ema.indexes[i] = config.dataTable.index;
                        dataTable.addColumn('number', 'EMA' + emaData["period"].toString());
                        config.ema.values[i] = emaData["values"]
                    }
                }

                if (data['bbands'] != undefined) {
                    var n = data['bbands']['n'];
                    var k = data['bbands']['k'];
                    var up = data['bbands']['up'];
                    var mid = data['bbands']['mid'];
                    var down = data['bbands']['down'];
                    config.dataTable.index += 1;
                    config.bbands.indexes[0] = config.dataTable.index;
                    config.dataTable.index += 1;
                    config.bbands.indexes[1] = config.dataTable.index;
                    config.dataTable.index += 1;
                    config.bbands.indexes[2] = config.dataTable.index;
                    dataTable.addColumn('number', 'BBands Up(' + n + ',' + k + ')');
                    dataTable.addColumn('number', 'BBands Mid(' + n + ',' + k + ')');
                    dataTable.addColumn('number', 'BBands Down(' + n + ',' + k + ')');
                    config.bbands.up = up;
                    config.bbands.mid = mid;
                    config.bbands.down = down;
                }

                if (data['atr'] != undefined) {
                    var n = data['atr']['n'];
                    var k = data['atr']['k'];
                    var up = data['atr']['up'];
                    var down = data['atr']['down'];
                    config.dataTable.index += 1;
                    config.atr.indexes[0] = config.dataTable.index;
                    config.dataTable.index += 1;
                    config.atr.indexes[1] = config.dataTable.index;
                    dataTable.addColumn('number', 'Atr Up(' + n + ',' + k + ')');
                    dataTable.addColumn('number', 'Atr Down(' + n + ',' + k + ')');
                    config.atr.up = up;
                    config.atr.down = down;
                }

                if (data['ichimoku'] != undefined) {
                    var tenkan = data['ichimoku']['tenkan'];
                    var kijun = data['ichimoku']['kijun'];
                    var senkouA = data['ichimoku']['senkou_a'];
                    var senkouB = data['ichimoku']['senkou_b'];
                    var chikou = data['ichimoku']['chikou'];

                    config.dataTable.index += 1;
                    config.ichimoku.indexes[0] = config.dataTable.index;
                    config.dataTable.index += 1;
                    config.ichimoku.indexes[1] = config.dataTable.index;
                    config.dataTable.index += 1;
                    config.ichimoku.indexes[2] = config.dataTable.index;
                    config.dataTable.index += 1;
                    config.ichimoku.indexes[3] = config.dataTable.index;
                    config.dataTable.index += 1;
                    config.ichimoku.indexes[4] = config.dataTable.index;

                    config.ichimoku.tenkan = tenkan;
                    config.ichimoku.kijun = kijun;
                    config.ichimoku.senkouA = senkouA;
                    config.ichimoku.senkouB = senkouB;
                    config.ichimoku.chikou = chikou;

                    dataTable.addColumn('number', 'Tenkan');
                    dataTable.addColumn('number', 'Kijun');
                    dataTable.addColumn('number', 'SenkouA');
                    dataTable.addColumn('number', 'SenkouB');
                    dataTable.addColumn('number', 'Chikou');
                }

                if (data['events'] != undefined) {
                    config.dataTable.index += 1;
                    config.events.indexes[0] = config.dataTable.index;
                    config.dataTable.index += 1;
                    config.events.indexes[1] = config.dataTable.index;

                    config.events.values = data['events']['signals'];
                    if (config.events.values != undefined) {
                        config.events.first = config.events.values.shift();
                    };

                    dataTable.addColumn('number', 'Marker');
                    dataTable.addColumn({type:'string', role:'annotation'});

                    if (data['events']['profit'] != undefined) {
                        profit = String(Math.round(data['events']['profit'] * 100) / 100);
                        $('#profit').html("Change:" + profit);
                    }
                }

                if (data['di'] != undefined) {
                    var n = data['di']['n'];
                    var plus_di = data['di']['plus_di'];
                    var minus_di = data['di']['minus_di'];
                    config.dataTable.index += 1;
                    config.di.indexes[0] = config.dataTable.index;
                    config.dataTable.index += 1;
                    config.di.indexes[1] = config.dataTable.index;
                    dataTable.addColumn('number', 'Plus_Di(' + n + ')');
                    dataTable.addColumn('number', 'Minus_Di(' + n + ')');
                    config.di.plus_di = plus_di;
                    config.di.minus_di = minus_di;
                }

                if (data['adx'] != undefined) {
                    var n = data['adx']['n'];
                    var adx = data['adx']['adx'];
                    var adxr = data['adx']['adxr'];
                    config.dataTable.index += 1;
                    config.adx.indexes[0] = config.dataTable.index;
                    config.dataTable.index += 1;
                    config.adx.indexes[1] = config.dataTable.index;
                    dataTable.addColumn('number', 'Adx(' + n + ')');
                    dataTable.addColumn('number', 'Adxr(' + n + ')');
                    config.adx.adx = adx;
                    config.adx.adxr = adxr;
                }

                if (data['rsi'] != undefined ){
                    config.dataTable.index += 1;
                    config.rsi.indexes['up'] = config.dataTable.index;
                    config.dataTable.index += 1;
                    config.rsi.indexes['value'] = config.dataTable.index;
                    config.dataTable.index += 1;
                    config.rsi.indexes['down'] = config.dataTable.index;
                    config.rsi.period = data['rsi']['period'];
                    config.rsi.values = data['rsi']['values'];
                    dataTable.addColumn('number', 'RSI Thread');
                    dataTable.addColumn('number', 'RSI(' + config.rsi.period + ')');
                    dataTable.addColumn('number', 'RSI Thread');
                }

                if (data['macd'] != undefined) {
                    var macdData = data['macd'];
                    var fast_period = macdData["fast_period"].toString();
                    var slow_period = macdData["slow_period"].toString();
                    var signal_period = macdData["signal_period"].toString();
                    var macd = macdData["macd"];
                    var macd_signal = macdData["macd_signal"];
                    var macd_hist = macdData["macd_hist"];

                    config.dataTable.index += 1;
                    config.macd.indexes[0] = config.dataTable.index;
                    config.dataTable.index += 1;
                    config.macd.indexes[1] = config.dataTable.index;
                    config.dataTable.index += 1;
                    config.macd.indexes[2] = config.dataTable.index;
                    var speriods = '(' + fast_period + ',' + slow_period + ',' + signal_period +')';
                    dataTable.addColumn('number', 'MD' + speriods);
                    dataTable.addColumn('number', 'MS' + speriods);
                    dataTable.addColumn('number', 'HT' + speriods);
                    config.macd.values[0] = macd;
                    config.macd.values[1] = macd_signal;
                    config.macd.values[2] = macd_hist;
                    config.macd.periods[0] = fast_period;
                    config.macd.periods[1] = slow_period;
                    config.macd.periods[2] = signal_period;
                }

                if (data["force_idx"] != undefined) {
                    for (i = 0; i < data['force_idx'].length; i++){
                        var forceIdxData = data['force_idx'][i];
                        if (forceIdxData.length == 0){ continue; }
                        config.dataTable.index += 1;
                        config.force_idx.indexes[i] = config.dataTable.index;
                        dataTable.addColumn('number', 'Force_Index' + forceIdxData["n"].toString());
                        config.force_idx.values[i] = forceIdxData["force_idx"]
                    }
                }

                var googleChartData = [];
                var candles = data["candles"];

                for(var i=0; i < candles.length; i++){
                    var candle = candles[i];
                    var date = new Date(candle.time);
                    var datas = [date, candle.low, candle.open, candle.close, candle.high, candle.volume];

                    if (data["smas"] != undefined) {
                        for (j = 0; j < config.sma.values.length; j++) {
                            if (config.sma.values[j][i] == 0) {
                                datas.push(null);
                            } else {
                                datas.push(config.sma.values[j][i]);
                            }
                        }
                    }

                    if (data["emas"] != undefined) {
                        for (j = 0; j < config.ema.values.length; j++) {
                            if (config.ema.values[j][i] == 0) {
                                datas.push(null);
                            } else {
                                datas.push(config.ema.values[j][i]);
                            }
                        }
                    }

                    if (data["bbands"] != undefined) {
                        if (config.bbands.up[i] == 0) {
                            datas.push(null);
                        } else {
                            datas.push(config.bbands.up[i]);
                        }
                        if (config.bbands.mid[i] == 0) {
                            datas.push(null);
                        } else {
                            datas.push(config.bbands.mid[i]);
                        }
                        if (config.bbands.down[i] == 0) {
                            datas.push(null);
                        } else {
                            datas.push(config.bbands.down[i]);
                        }
                    }

                    if (data["atr"] != undefined) {
                        if (config.atr.up[i] == 0) {
                            datas.push(null);
                        } else {
                            datas.push(config.atr.up[i]);
                        }
                        if (config.atr.down[i] == 0) {
                            datas.push(null);
                        } else {
                            datas.push(config.atr.down[i]);
                        }
                    }

                    if (data["ichimoku"] != undefined) {
                        if (config.ichimoku.tenkan[i] == 0) {
                            datas.push(null);
                        } else {
                            datas.push(config.ichimoku.tenkan[i]);
                        }
                        if (config.ichimoku.kijun[i] == 0) {
                            datas.push(null);
                        } else {
                            datas.push(config.ichimoku.kijun[i]);
                        }
                        if (config.ichimoku.senkouA[i] == 0) {
                            datas.push(null);
                        } else {
                            datas.push(config.ichimoku.senkouA[i]);
                        }
                        if (config.ichimoku.senkouB[i] == 0) {
                            datas.push(null);
                        } else {
                            datas.push(config.ichimoku.senkouB[i]);
                        }
                        if (config.ichimoku.chikou[i] == 0) {
                            datas.push(null);
                        } else {
                            datas.push(config.ichimoku.chikou[i]);
                        }
                    }

                    if (data['events'] != undefined) {
                        var event = config.events.first
                        if (event == undefined) {
                            datas.push(null);
                            datas.push(null);
                        }else if(event.time == candle.time) {
                            datas.push(candle.high);
                            datas.push(event.side);
                            config.events.first = config.events.values.shift();
                        }else{
                            datas.push(null);
                            datas.push(null);
                        }
                    }

                    if (data["di"] != undefined) {
                        if (config.di.plus_di[i] == 0) {
                            datas.push(null);
                        } else {
                            datas.push(config.di.plus_di[i]);
                        }
                        if (config.di.minus_di[i] == 0) {
                            datas.push(null);
                        } else {
                            datas.push(config.di.minus_di[i]);
                        }
                    }

                    if (data["adx"] != undefined) {
                        if (config.adx.adx[i] == 0) {
                            datas.push(null);
                        } else {
                            datas.push(config.adx.adx[i]);
                        }
                        if (config.adx.adxr[i] == 0) {
                            datas.push(null);
                        } else {
                            datas.push(config.adx.adxr[i]);
                        }
                    }

                    if (data["rsi"] != undefined){
                        datas.push(config.rsi.up);
                        if (config.rsi.values[i] == 0) {
                            datas.push(null);
                        }else{
                            datas.push(config.rsi.values[i]);
                        }
                        datas.push(config.rsi.down);
                    }

                    if (data["macd"] != undefined) {
                        for (j = 0; j < config.macd.values.length; j++) {
                            if (config.macd.values[j][i] == 0) {
                                datas.push(null);
                            } else {
                                datas.push(config.macd.values[j][i]);
                            }
                        }
                    }

                    if (data["force_idx"] != undefined) {
                        for (j = 0; j < config.force_idx.values.length; j++) {
                            if (config.force_idx.values[j][i] == 0) {
                                datas.push(null);
                            } else {
                                datas.push(config.force_idx.values[j][i]);
                            }
                        }
                    }

                    googleChartData.push(datas)
                }

                dataTable.addRows(googleChartData);
                drawChart(dataTable);
            })
        }

        function changeDuration(s){
            config.candlestick.duration = s;
            send();
        }

        function changeProduct(s){
            config.candlestick.product_code = s;
            send();
        }

        setInterval(send, 1000 * 3);
        window.onload = function () {
            send();

            $('#dashboard_div').mouseenter(function() {
                config.api.enable = false;
            }).mouseleave(function() {
                config.api.enable = true;
            });

            $('#inputSma').change(function() {
                if (this.checked === true) {
                    config.sma.enable = true;
                } else {
                    config.sma.enable = false;
                }
                send();
            });
            $("#inputSmaPeriod1").change(function() {
                config.sma.periods[0] = this.value;
                send();
            });
            $("#inputSmaPeriod2").change(function() {
                config.sma.periods[1] = this.value;
                send();
            });
            $("#inputSmaPeriod3").change(function() {
                config.sma.periods[2] = this.value;
                send();
            });

            $('#inputEma').change(function() {
                if (this.checked === true) {
                    config.ema.enable = true;
                } else {
                    config.ema.enable = false;
                }
                send();
            });
            $("#inputEmaPeriod1").change(function() {
                config.ema.periods[0] = this.value;
                send();
            });
            $("#inputEmaPeriod2").change(function() {
                config.ema.periods[1] = this.value;
                send();
            });
            $("#inputEmaPeriod3").change(function() {
                config.ema.periods[2] = this.value;
                send();
            });

            $('#inputBBands').change(function() {
                if (this.checked === true) {
                    config.bbands.enable = true;
                } else {
                    config.bbands.enable = false;
                }
                send();
            });
            $("#inputBBandsN").change(function() {
                config.bbands.n = this.value;
                send();
            });
            $("#inputBBandsK").change(function() {
                config.bbands.k = this.value;
                send();
            });

            $('#inputAtr').change(function() {
                if (this.checked === true) {
                    config.atr.enable = true;
                } else {
                    config.atr.enable = false;
                }
                send();
            });
            $("#inputAtrN").change(function() {
                config.atr.n = this.value;
                send();
            });
            $("#inputAtrK").change(function() {
                config.atr.k = this.value;
                send();
            });

            $('#inputIchimoku').change(function() {
                if (this.checked === true) {
                    config.ichimoku.enable = true;
                } else {
                    config.ichimoku.enable = false;
                }
                send();
            });

            $('#inputVolume').change(function() {
                if (this.checked === true) {
                    config.volume.enable = true;
                    drawChart(config.dataTable.value);
                } else {
                    config.volume.enable = false;
                    $('#volume_div').remove();
                }
            });

            $('#inputDi').change(function() {
                if (this.checked === true) {
                    config.di.enable = true;
                } else {
                    $('#di_div').remove();
                    config.di.enable = false;
                }
                send();
            });
            $("#inputDiN").change(function() {
                config.di.n = this.value;
                send();
            });

            $('#inputAdx').change(function() {
                if (this.checked === true) {
                    config.adx.enable = true;
                } else {
                    $('#adx_div').remove();
                    config.adx.enable = false;
                }
                send();
            });
            $("#inputAdxN").change(function() {
                config.adx.n = this.value;
                send();
            });

            $('#inputRsi').change(function() {
                if (this.checked === true) {
                    config.rsi.enable = true;
                } else {
                    config.rsi.enable = false;
                    $('#rsi_div').remove();
                }
                send();
            });
            $("#inputRsiPeriod").change(function() {
                config.rsi.period = this.value;
                send();
            });

            $('#inputMacd').change(function() {
                if (this.checked === true) {
                    config.macd.enable = true;
                } else {
                    $('#macd_div').remove();
                    config.macd.enable = false;
                }
                send();
            });
            $("#inputMacdPeriod1").change(function() {
                config.macd.periods[0] = this.value;
                send();
            });
            $("#inputMacdPeriod2").change(function() {
                config.macd.periods[1] = this.value;
                send();
            });
            $("#inputMacdPeriod3").change(function() {
                config.macd.periods[2] = this.value;
                send();
            });

            $('#inputForceIdx').change(function() {
                if (this.checked === true) {
                    config.force_idx.enable = true;
                } else {
                    $('#force_idx_div').remove();
                    config.force_idx.enable = false;
                }
                send();
            });
            $("#inputForceIdxPeriod1").change(function() {
                config.force_idx.periods[0] = 1;
                config.force_idx.periods[1] = this.value;
                send();
            });
            $("#inputForceIdxPeriod2").change(function() {
                config.force_idx.periods[2] = this.value;
                send();
            });

            $('#inputEvents').change(function() {
                if (this.checked === true) {
                    config.events.enable = true;
                } else {
                    config.events.enable = false;
                    $('#profit').html("");
                }
                send();
            });

        }

    </script>
</head>
<body>

<div>
    <button onclick="changeDuration('5s');">5s</button>
    <button onclick="changeDuration('1m');">1m</button>
    <button onclick="changeDuration('5m');">5m</button>
    <button onclick="changeDuration('15m');">15m</button>
    <button onclick="changeDuration('30m');">30m</button>
    <button onclick="changeDuration('1h');">1h</button>
    <button onclick="changeDuration('1d');">1d</button>
</div>

<div>
    <button onclick="changeProduct('USD_JPY');">USD_JPY</button>
    <button onclick="changeProduct('EUR_JPY');">EUR_JPY</button>
    <button onclick="changeProduct('EUR_USD');">EUR_USD</button>
    <button onclick="changeProduct('GBP_JPY');">GBP_JPY</button>
    <button onclick="changeProduct('GBP_USD');">GBP_USD</button>
    <button onclick="changeProduct('AUD_JPY');">AUD_JPY</button>
    <button onclick="changeProduct('FX_BTC_JPY');">FX_BTC_JPY</button>
</div>

<div>
    SMA <input id="inputSma" type="checkbox">
    Period<input id="inputSmaPeriod1" type="text" value="7" style="width: 15px;">
    <input id="inputSmaPeriod2" type="text" value="14" style="width: 15px;">
    <input id="inputSmaPeriod3" type="text" value="50" style="width: 15px;">
</div>

<div>
    EMA <input id="inputEma" type="checkbox">
    Period<input id="inputEmaPeriod1" type="text" value="7" style="width: 15px;">
    <input id="inputEmaPeriod2" type="text" value="14" style="width: 15px;">
    <input id="inputEmaPeriod3" type="text" value="50" style="width: 15px;">
</div>

<div>
    BBands <input id="inputBBands" type="checkbox">
    N <input id="inputBBandsN" type="text" value="20" style="width: 15px;">
    K <input id="inputBBandsK" type="text" value="2" style="width: 15px;">
</div>

<div>
    Atr <input id="inputAtr" type="checkbox">
    N <input id="inputAtrN" type="text" value="14" style="width: 15px;">
    K <input id="inputAtrK" type="text" value="2" style="width: 15px;">
</div>

<div>
    Ichimoku <input id="inputIchimoku" type="checkbox">
</div>

<div>
    Volume <input id="inputVolume" type="checkbox">
</div>

<div>
    Di <input id="inputDi" type="checkbox">
    N <input id="inputDiN" type="text" value="14" style="width: 15px;">
</div>

<div>
    Adx <input id="inputAdx" type="checkbox">
    N <input id="inputAdxN" type="text" value="14" style="width: 15px;">
</div>

<div>
    Rsi <input id="inputRsi" type="checkbox">
    Period <input id="inputRsiPeriod" type="text" value="14" style="width: 15px;">
</div>

<div>
    MACD <input id="inputMacd" type="checkbox">
    Period<input id="inputMacdPeriod1" type="text" value="12" style="width: 15px;">
    <input id="inputMacdPeriod2" type="text" value="26" style="width: 15px;">
    <input id="inputMacdPeriod3" type="text" value="9" style="width: 15px;">
</div>

<div>
    勢力指数 <input id="inputForceIdx" type="checkbox">
    Period<input id="inputForceIdxPeriod1" type="text" value="2" style="width: 15px;">
    <input id="inputForceIdxPeriod2" type="text" value="13" style="width: 15px;">
</div>

<div>
    Events <input id="inputEvents" type="checkbox"> <div id="profit"></div>
</div>

<div id="dashboard_div">
    <div id="chart_div"></div>
    <div id="technical_div"></div>
    <div id="filter_div"></div>
</div>

</body>
</html>
